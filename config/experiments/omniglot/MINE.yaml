data:
  class_path: core.data.datamodule.MultiOmniglotDataModule
  init_args:
    n_images: 1
    num_workers: 24
    batch_size: 128

model:
  class_path: core.task.InfoMax
  init_args:
    encoder_x:
      class_path: core.models.encoder.OmniglotResNet
      init_args:
        n_images: 1
        out_dim: 128
    encoder_y: same
    mi_estimator:
      class_path: core.models.mi_estimator.MINE
      init_args:
        x_dim: 128
        y_dim: 128
        hidden_dims: [512, 256]
    optimizer_class: torch.optim.Adam
    optimizer_init_args:
        lr: 1e-3
    lr_scheduler_class: core.optim.lr_scheduler.WarmupScheduler
    lr_scheduler_init_args:
      warmup_steps: 10 #10*[162770/64]
      total_steps: 100 #100*[162770/64]
    lr_scheduler_params:
      frequency: 1
      interval: step

trainer:
  max_epochs: 100
  callbacks:
    - class_path: pytorch_lightning.callbacks.LearningRateMonitor
    - class_path: core.callbacks.VarianceLogCallback
      init_args:
          key: ["mi/value", "mi/grad", "mi/primal/value", "mi/primal/grad", "mi/dual/value", "mi/dual/grad"]
#    - class_path: core.callbacks.SSLOnlineEvaluator
#      init_args:
#        train_on: z_x
#        evaluate_on: z_o
#        target: t
#        z_dim: 512
#        hidden_dim: 256
#        num_classes: 2
#        t_dim: 30



#lr_scheduler:
#  class_path: core.optim.lr_scheduler.SimCLRScheduler
#  init_args:
#    warmup_steps: 1
#    total_steps: 100
